Port from python. Will need work.